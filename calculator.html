<!DOCTYPE html>
<html lang="en" class="dark scroll-smooth">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Online Calculator • UtilityKit</title>
  <meta name="description" content="Free online scientific calculator, percentage, age, BMI, loan, tip & unit converter. 100% private • No upload • Works offline • Instant">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <style>
    .copy-feedback { opacity: 0; transition: opacity 0.4s; }
    .copy-feedback.show { opacity: 1; }
    #live-clock { animation: pulse 2s infinite; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-100 dark:from-slate-950 dark:to-slate-900 min-h-screen">

 <!-- Header -->
<header class="bg-white/80 dark:bg-slate-900/80 backdrop-blur-md shadow-lg sticky top-0 z-50">
  <div class="container mx-auto px-6 py-5 flex flex-wrap items-center justify-between">
    <a href="index.html" class="flex items-center gap-3">
      <h1 class="text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-purple-600">UtilityKit</h1>
    </a>
    <nav class="flex flex-wrap gap-4 md:gap-6 text-lg">
      <a href="pdf.html" class="nav-link hover:text-blue-600 dark:hover:text-blue-400 transition"><i class="fa-solid fa-file-pdf mr-1"></i>PDF</a>
      <a href="image.html" class="nav-link hover:text-blue-600 dark:hover:text-blue-400 transition"><i class="fa-solid fa-image mr-1"></i>Image</a>
      <a href="qr.html" class="nav-link hover:text-blue-600 dark:hover:text-blue-400 transition"><i class="fa-solid fa-qrcode mr-1"></i>QR</a>
      <a href="ocr.html" class="nav-link hover:text-blue-600 dark:hover:text-blue-400 transition"><i class="fa-solid fa-eye mr-1"></i>OCR</a>
      <a href="calculator.html" class="nav-link hover:text-blue-600 dark:hover:text-blue-400 transition"><i class="fa-solid fa-gauge-high mr-1"></i>Calculator</a>
      <a href="password.html" class="nav-link hover:text-blue-600 dark:hover:text-blue-400 transition"><i class="fa-solid fa-key mr-1"></i>Password</a>
      <a href="json.html" class="nav-link hover:text-blue-600 dark:hover:text-blue-400 transition"><i class="fa-solid fa-code mr-1"></i>JSON</a>
      <a href="base64.html" class="nav-link hover:text-blue-600 dark:hover:text-blue-400 transition"><i class="fa-solid fa-lock mr-1"></i>Base64</a>
      <a href="timestamp.html" class="nav-link hover:text-blue-600 dark:hover:text-blue-400 transition"><i class="fa-solid fa-clock mr-1"></i>Timestamp</a>
      
      <!-- === NEW TOOLS IN NAV === -->
      <a href="compress.html" class="nav-link hover:text-blue-600 dark:hover:text-blue-400 transition"><i class="fa-solid fa-file-zipper mr-1"></i>Compressor</a>
      <a href="markdown.html" class="nav-link hover:text-blue-600 dark:hover:text-blue-400 transition"><i class="fa-brands fa-markdown mr-1"></i>Markdown</a>
      <a href="currency.html" class="nav-link hover:text-blue-600 dark:hover:text-blue-400 transition"><i class="fa-solid fa-dollar-sign mr-1"></i>Currency</a>
    </nav>
  </div>
</header>
<head>
<body class="bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-100 dark:from-slate-950 dark:to-slate-900 min-h-screen">
  <div class="container mx-auto px-6 py-16 max-w-7xl">
    <div class="text-center mb-16">
      <a href="index.html" class="inline-flex items-center text-indigo-600 dark:text-indigo-400 mb-4 hover:underline">
        <i class="fa-solid fa-arrow-left mr-2"></i> Back to UtilityKit
      </a>
      <h1 class="text-6xl font-black text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-purple-600 mb-4">Calculators</h1>
      <p class="text-2xl text-slate-700 dark:text-slate-300">All-in-one • Private • Instant • Keyboard Support</p>
    </div>

    <div class="flex justify-center mb-10 overflow-x-auto bg-gray-100 dark:bg-slate-900 rounded-t-2xl -mb-px">
      <button class="tab-btn active px-6 py-4 text-lg font-semibold" data-tab="scientific">Scientific</button>
      <button class="tab-btn px-6 py-4 text-lg font-semibold" data-tab="percentage">Percentage</button>
      <button class="tab-btn px-6 py-4 text-lg font-semibold" data-tab="age">Age</button>
      <button class="tab-btn px-6 py-4 text-lg font-semibold" data-tab="bmi">BMI</button>
      <button class="tab-btn px-6 py-4 text-lg font-semibold" data-tab="loan">Loan</button>
      <button class="tab-btn px-6 py-4 text-lg font-semibold" data-tab="date">Date Diff</button>
      <button class="tab-btn px-6 py-4 text-lg font-semibold" data-tab="unit">Unit</button>
    </div>

    <div class="bg-white dark:bg-slate-800 rounded-3xl p-8 md:p-12 shadow-2xl">

      <div id="scientific" class="tab-content">
        <h2 class="text-3xl font-bold mb-6 text-center text-slate-800 dark:text-slate-200">Scientific Calculator</h2>
        <div class="max-w-lg mx-auto">
          <div class="flex items-center mb-4">
            <input type="text" id="sci-display" class="flex-1 p-5 text-right text-3xl bg-gray-100 dark:bg-slate-900 rounded-l-xl input-field" readonly placeholder="0">
            <button onclick="copyResult()" class="p-5 bg-indigo-600 hover:bg-indigo-700 text-white rounded-r-xl transition">
              <i class="fa-solid fa-copy"></i>
            </button>
          </div>
          <div id="sci-history" class="max-h-48 overflow-y-auto mb-6 text-sm text-slate-500 dark:text-slate-400 space-y-1 bg-gray-50 dark:bg-slate-900 p-3 rounded-lg"></div>
          <div class="grid grid-cols-4 gap-3">
            <button class="btn col-span-2 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 p-5 rounded-xl text-2xl" onclick="sciClear()">C</button>
            <button class="btn bg-orange-100 dark:bg-orange-900 text-orange-700 p-5 rounded-xl text-2xl" onclick="sciBackspace()">←</button>
            <button class="btn bg-indigo-100 dark:bg-indigo-900 text-indigo-700 p-5 rounded-xl text-2xl" onclick="sciInput('/')">÷</button>

            <button class="btn bg-gray-100 dark:bg-slate-900 p-5 rounded-xl text-2xl" onclick="sciInput('7')">7</button>
            <button class="btn bg-gray-100 dark:bg-slate-900 p-5 rounded-xl text-2xl" onclick="sciInput('8')">8</button>
            <button class="btn bg-gray-100 dark:bg-slate-900 p-5 rounded-xl text-2xl" onclick="sciInput('9')">9</button>
            <button class="btn bg-indigo-100 dark:bg-indigo-900 text-indigo-700 p-5 rounded-xl text-2xl" onclick="sciInput('*')">×</button>

            <button class="btn bg-gray-100 dark:bg-slate-900 p-5 rounded-xl text-2xl" onclick="sciInput('4')">4</button>
            <button class="btn bg-gray-100 dark:bg-slate-900 p-5 rounded-xl text-2xl" onclick="sciInput('5')">5</button>
            <button class="btn bg-gray-100 dark:bg-slate-900 p-5 rounded-xl text-2xl" onclick="sciInput('6')">6</button>
            <button class="btn bg-indigo-100 dark:bg-indigo-900 text-indigo-700 p-5 rounded-xl text-2xl" onclick="sciInput('-')">−</button>

            <button class="btn bg-gray-100 dark:bg-slate-900 p-5 rounded-xl text-2xl" onclick="sciInput('1')">1</button>
            <button class="btn bg-gray-100 dark:bg-slate-900 p-5 rounded-xl text-2xl" onclick="sciInput('2')">2</button>
            <button class="btn bg-gray-100 dark:bg-slate-900 p-5 rounded-xl text-2xl" onclick="sciInput('3')">3</button>
            <button class="btn bg-indigo-100 dark:bg-indigo-900 text-indigo-700 p-5 rounded-xl text-2xl row-span-2" onclick="sciCalculate()">=</button>

            <button class="btn bg-gray-100 dark:bg-slate-900 p-5 rounded-xl text-2xl col-span-2" onclick="sciInput('0')">0</button>
            <button class="btn bg-gray-100 dark:bg-slate-900 p-5 rounded-xl text-2xl" onclick="sciInput('.')">.</button>

            <button class="btn bg-purple-100 dark:bg-purple-900 text-purple-700 p-4 rounded-xl text-lg" onclick="sciFunc('sin')">sin</button>
            <button class="btn bg-purple-100 dark:bg-purple-900 text-purple-700 p-4 rounded-xl text-lg" onclick="sciFunc('cos')">cos</button>
            <button class="btn bg-purple-100 dark:bg-purple-900 text-purple-700 p-4 rounded-xl text-lg" onclick="sciFunc('tan')">tan</button>
            <button class="btn bg-purple-100 dark:bg-purple-900 text-purple-700 p-4 rounded-xl text-lg" onclick="sciInput('Math.PI')">π</button>
            <button class="btn bg-purple-100 dark:bg-purple-900 text-purple-700 p-4 rounded-xl text-lg" onclick="sciFunc('log')">log</button>
            <button class="btn bg-purple-100 dark:bg-purple-900 text-purple-700 p-4 rounded-xl text-lg" onclick="sciFunc('sqrt')">√</button>
            <button class="btn bg-purple-100 dark:bg-purple-900 text-purple-700 p-4 rounded-xl text-lg" onclick="sciInput('**')">^</button>
            <button class="btn bg-purple-100 dark:bg-purple-900 text-purple-700 p-4 rounded-xl text-lg" onclick="sciInput('('">(</button>
            <button class="btn bg-purple-100 dark:bg-purple-900 text-purple-700 p-4 rounded-xl text-lg" onclick="sciInput(')')">)</button>
          </div>
        </div>
      </div>

      <div id="percentage" class="tab-content hidden">
        <h2 class="text-3xl font-bold mb-6 text-center">Percentage Calculator</h2>
        <div class="max-w-2xl mx-auto space-y-8">
          <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            <button onclick="quickTip(15)" class="bg-green-100 dark:bg-green-900 hover:bg-green-200 p-5 rounded-xl text-lg font-medium">15% Tip</button>
            <button onclick="quickTip(20)" class="bg-green-100 dark:bg-green-900 hover:bg-green-200 p-5 rounded-xl text-lg font-medium">20% Tip</button>
            <button onclick="quickDiscount(20)" class="bg-purple-100 dark:bg-purple-900 hover:bg-purple-200 p-5 rounded-xl text-lg font-medium">20% Off</button>
            <button onclick="quickTax()" class="bg-orange-100 dark:bg-orange-900 hover:bg-orange-200 p-5 rounded-xl text-lg font-medium">8.875% Tax</button>
          </div>
          <div class="grid md:grid-cols-3 gap-6 text-center">
            <div class="bg-gray-50 dark:bg-slate-900 p-6 rounded-2xl">
              <label class="block mb-3 text-lg">X% of Y</label>
              <input type="number" id="perc-x1" placeholder="15" class="w-full p-3 mb-2 rounded input-field" oninput="calculateAllPercentages()">
              <input type="number" id="perc-y1" placeholder="89.99" class="w-full p-3 rounded input-field" oninput="calculateAllPercentages()">
              <p class="mt-4 text-2xl font-bold text-indigo-600 dark:text-indigo-400" id="perc-res1">-</p>
            </div>
            <div class="bg-gray-50 dark:bg-slate-900 p-6 rounded-2xl">
              <label class="block mb-3 text-lg">X is what % of Y</label>
              <input type="number" id="perc-x2" placeholder="25" class="w-full p-3 mb-2 rounded input-field" oninput="calculateAllPercentages()">
              <input type="number" id="perc-y2" placeholder="200" class="w-full p-3 rounded input-field" oninput="calculateAllPercentages()">
              <p class="mt-4 text-2xl font-bold text-indigo-600 dark:text-indigo-400" id="perc-res2">-</p>
            </div>
            <div class="bg-gray-50 dark:bg-slate-900 p-6 rounded-2xl">
              <label class="block mb-3 text-lg">Increase / Decrease</label>
              <input type="number" id="perc-from" placeholder="100" class="w-full p-3 mb-2 rounded input-field" oninput="calculateAllPercentages()">
              <input type="number" id="perc-to" placeholder="125" class="w-full p-3 rounded input-field" oninput="calculateAllPercentages()">
              <p class="mt-4 text-2xl font-bold text-indigo-600 dark:text-indigo-400" id="perc-res-change">-</p>
            </div>
          </div>
        </div>
      </div>

      <div id="age" class="tab-content hidden text-center">
  <h2 class="text-3xl font-bold mb-8 text-slate-800 dark:text-slate-200">Age Calculator</h2>
  
  <div class="max-w-xl mx-auto bg-gray-50 dark:bg-slate-900 p-6 rounded-2xl shadow-sm">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
      <div>
        <label class="block text-sm font-semibold text-slate-500 mb-2">Date of Birth / From</label>
        <input type="date" id="age-from" class="w-full p-4 text-lg text-center rounded-xl input-field bg-white dark:bg-slate-800 border border-gray-200 dark:border-slate-700" onchange="calculateAge()">
      </div>
      <div>
        <label class="block text-sm font-semibold text-slate-500 mb-2">Calculate To / Until</label>
        <input type="date" id="age-to" class="w-full p-4 text-lg text-center rounded-xl input-field bg-white dark:bg-slate-800 border border-gray-200 dark:border-slate-700" onchange="calculateAge()">
      </div>
    </div>

    <div class="p-6 bg-indigo-50 dark:bg-slate-800 rounded-xl border border-indigo-100 dark:border-slate-700">
      <p class="text-lg text-slate-500 dark:text-slate-400 uppercase tracking-wide text-xs font-bold mb-2">Exact Age</p>
      <p class="text-4xl md:text-5xl font-black text-indigo-600 dark:text-indigo-400" id="age-result">--</p>
    </div>
  </div>
</div>

     <div id="bmi" class="tab-content hidden text-center">
  <h2 class="text-3xl font-bold mb-8 text-slate-800 dark:text-slate-200">BMI Calculator</h2>
  
  <div class="grid md:grid-cols-2 gap-8 max-w-4xl mx-auto">
    <div class="space-y-6">
      <div class="bg-gray-50 dark:bg-slate-900 p-6 rounded-2xl">
        <label class="block text-left text-sm font-bold text-slate-500 mb-2 ml-1">Height</label>
        <div class="relative">
          <input type="number" id="bmi-height" placeholder="e.g. 175" class="w-full p-4 pl-4 pr-16 text-xl rounded-xl input-field" oninput="calcBMI()">
          <span class="absolute right-6 top-4 text-slate-400 font-bold">cm</span>
        </div>
      </div>

      <div class="bg-gray-50 dark:bg-slate-900 p-6 rounded-2xl">
        <label class="block text-left text-sm font-bold text-slate-500 mb-2 ml-1">Weight</label>
        <div class="relative">
          <input type="number" id="bmi-weight" placeholder="e.g. 70" class="w-full p-4 pl-4 pr-16 text-xl rounded-xl input-field" oninput="calcBMI()">
          <span class="absolute right-6 top-4 text-slate-400 font-bold">kg</span>
        </div>
      </div>

      <div class="p-6 bg-white dark:bg-slate-800 rounded-2xl shadow-lg border border-indigo-50 dark:border-slate-700">
        <p class="text-sm text-slate-500 uppercase font-bold mb-2">Your BMI</p>
        <p class="text-5xl font-black text-indigo-600 dark:text-indigo-400 mb-2" id="bmi-res">--</p>
        <p class="text-xl font-medium text-slate-700 dark:text-slate-300" id="bmi-category">Enter details</p>
      </div>
    </div>

    <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-lg border border-gray-100 dark:border-slate-700 overflow-hidden">
      <div class="bg-slate-100 dark:bg-slate-900 p-4 border-b dark:border-slate-700">
        <h3 class="font-bold text-lg text-slate-700 dark:text-slate-300">BMI Categories</h3>
      </div>
      <table class="w-full text-left border-collapse">
        <thead>
          <tr class="text-xs uppercase text-slate-500 border-b dark:border-slate-700">
            <th class="p-4">Category</th>
            <th class="p-4 text-right">Range</th>
          </tr>
        </thead>
        <tbody class="text-sm">
          <tr class="border-b dark:border-slate-700" id="row-under">
            <td class="p-4 font-medium text-blue-500">Underweight</td>
            <td class="p-4 text-right text-slate-600 dark:text-slate-400">&lt; 18.5</td>
          </tr>
          <tr class="border-b dark:border-slate-700 bg-green-50/50 dark:bg-green-900/10" id="row-normal">
            <td class="p-4 font-medium text-green-600">Normal Weight</td>
            <td class="p-4 text-right text-slate-600 dark:text-slate-400">18.5 – 24.9</td>
          </tr>
          <tr class="border-b dark:border-slate-700" id="row-over">
            <td class="p-4 font-medium text-orange-500">Overweight</td>
            <td class="p-4 text-right text-slate-600 dark:text-slate-400">25 – 29.9</td>
          </tr>
          <tr id="row-obese">
            <td class="p-4 font-medium text-red-500">Obesity</td>
            <td class="p-4 text-right text-slate-600 dark:text-slate-400">≥ 30</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

      <div id="loan" class="tab-content hidden text-center">
        <h2 class="text-3xl font-bold mb-8">Loan / Mortgage Calculator</h2>
        <div class="max-w-md mx-auto space-y-6">
          <input type="number" id="loan-amount" placeholder="Loan Amount ($)" class="w-full p-5 text-xl rounded-2xl input-field">
          <input type="number" step="0.01" id="loan-rate" placeholder="Annual Rate (%)" class="w-full p-5 text-xl rounded-2xl input-field">
          <input type="number" id="loan-term" placeholder="Term (years)" class="w-full p-5 text-xl rounded-2xl input-field">
          <button onclick="calcLoan()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white py-5 rounded-2xl text-xl font-bold">Calculate Payment</button>
          <p class="text-4xl font-bold text-indigo-600 dark:text-indigo-400" id="loan-res"></p>
        </div>
      </div>

      <div id="date" class="tab-content hidden text-center">
        <h2 class="text-3xl font-bold mb-8">Date Difference</h2>
        <div class="max-w-md mx-auto space-y-6">
          <input type="date" id="date-start" class="w-full p-5 text-xl rounded-2xl input-field">
          <input type="date" id="date-end" class="w-full p-5 text-xl rounded-2xl input-field">
          <button onclick="calcDateDiff()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white py-5 rounded-2xl text-xl font-bold">Calculate Days</button>
          <p class="text-4xl font-bold text-indigo-600 dark:text-indigo-400" id="date-res"></p>
        </div>
      </div>

      <div id="unit" class="tab-content hidden">
        <h2 class="text-3xl font-bold mb-8 text-center">Unit Converter</h2>
        <div class="max-w-md mx-auto space-y-6">
          <label class="block text-sm text-slate-500 mb-1 ml-2">Category</label>
          <select id="unit-category" onchange="updateUnits()" class="w-full p-5 text-xl rounded-2xl input-field"></select>
          
          <label class="block text-sm text-slate-500 mb-1 ml-2">Value & From Unit</label>
          <div class="flex gap-2">
            <input type="number" id="unit-from" oninput="convertUnit()" placeholder="Enter value" class="w-2/3 p-5 text-xl rounded-2xl input-field">
            <select id="unit-from-type" onchange="convertUnit()" class="w-1/3 p-2 text-lg rounded-2xl input-field text-center"></select>
          </div>

          <label class="block text-sm text-slate-500 mb-1 ml-2">To Unit</label>
          <select id="unit-to-type" onchange="convertUnit()" class="w-full p-5 text-xl rounded-2xl input-field"></select>
          
          <p class="text-center text-4xl font-bold text-indigo-600 dark:text-indigo-400 mt-8" id="unit-res"></p>
        </div>
      </div>

    </div>

    <footer class="text-center mt-20 text-slate-600 dark:text-slate-400">
      <p class="text-xl">© 2025 UtilityKit • Made with <span class="text-red-500">♥</span> for privacy</p>
    </footer>
  </div>

 <script>
    // Data structures for Unit Converter (retained from original file)
    const units = {
        'length': {
            'm': 1, 'cm': 100, 'mm': 1000, 'km': 0.001, 'in': 39.3701, 'ft': 3.28084, 'yd': 1.09361, 'mi': 0.000621371
        },
        'mass': {
            'kg': 1, 'g': 1000, 'mg': 1000000, 'lb': 2.20462, 'oz': 35.274, 't': 0.001
        },
        'volume': {
            'l': 1, 'ml': 1000, 'gal': 0.264172, 'qt': 1.05669, 'pt': 2.11338, 'cup': 4.22675
        },
        'temperature': {
            'c': 1, 'f': 33.8, 'k': 274.15
        }
    };

    // Global variable to store current category for Unit Converter
    let currentCategory = 'length';


    // --- 1. TABS ACTIVATION LOGIC (FIXED) ---
    // This wrapper ensures the script runs AFTER the HTML elements (the tabs) are available.
    document.addEventListener('DOMContentLoaded', () => {

        // --- Tab Switching Logic ---
        const tabs = document.querySelectorAll('.tab-btn');
        const contents = document.querySelectorAll('.tab-content');
        
        // Find the default active tab content and show it (if calculator tab is active by default)
        const defaultTab = document.querySelector('.tab-btn.bg-indigo-600');
        if (defaultTab) {
            const defaultTargetId = defaultTab.getAttribute('data-tab');
            const defaultContent = document.getElementById(defaultTargetId);
            if (defaultContent) {
                defaultContent.classList.remove('hidden');
            }
        }


        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                // Reset all tabs appearance
                tabs.forEach(t => {
                    t.classList.remove('bg-indigo-600', 'text-white');
                    t.classList.add('text-slate-500', 'hover:text-slate-700');
                });
                
                // Activate clicked tab appearance
                tab.classList.remove('text-slate-500', 'hover:text-slate-700');
                tab.classList.add('bg-indigo-600', 'text-white');

                // Hide all content
                contents.forEach(c => c.classList.add('hidden'));

                // Show target content
                const targetId = tab.getAttribute('data-tab');
                const targetContent = document.getElementById(targetId);
                if (targetContent) {
                    targetContent.classList.remove('hidden');

                    // If the BMI tab is opened, run the calculation (in case previous values were left in)
                    if (targetId === 'bmi') calcBMI();
                    
                    // If the Age tab is opened, initialize and calculate
                    if (targetId === 'age') {
                        const ageToInput = document.getElementById('age-to');
                        if (ageToInput && !ageToInput.value) {
                            ageToInput.valueAsDate = new Date();
                        }
                        calculateAge();
                    }
                }
            });
        });

        // --- Age Calculator Initialization ---
        // Set default "To" date to today on load
        const ageToInput = document.getElementById('age-to');
        if (ageToInput) {
            ageToInput.valueAsDate = new Date();
        }

        // Initialize Unit Converter Categories (retained)
        document.getElementById('unit-category').innerHTML = Object.keys(units).map(c=>`<option value=\"${c}\">${c.charAt(0).toUpperCase()+c.slice(1)}</option>`).join('');
        updateUnits();
    });


    // --- 2. CALCULATOR FUNCTIONS (Keep in Global Scope for HTML onclick to work) ---

    // Scientific Calculator Functions (retained)
    const display = document.getElementById('calc-display');
    let currentInput = '0';
    let previousInput = '';
    let operator = null;
    let waitForSecondOperand = true;

    function clearAll() {
        currentInput = '0';
        previousInput = '';
        operator = null;
        waitForSecondOperand = true;
        display.value = currentInput;
    }

    function inputDigit(digit) {
        if (waitForSecondOperand) {
            currentInput = digit;
            waitForSecondOperand = false;
        } else {
            currentInput = currentInput === '0' ? digit : currentInput + digit;
        }
        display.value = currentInput;
    }

    function inputDecimal(dot) {
        if (waitForSecondOperand) {
            currentInput = '0.';
            waitForSecondOperand = false;
        } else if (!currentInput.includes(dot)) {
            currentInput += dot;
        }
        display.value = currentInput;
    }

    function handleOperator(nextOperator) {
        const inputValue = parseFloat(currentInput);

        if (operator && waitForSecondOperand) {
            operator = nextOperator;
            return;
        }

        if (previousInput === '') {
            previousInput = inputValue;
        } else if (operator) {
            const result = performCalculation[operator](previousInput, inputValue);
            currentInput = String(result);
            previousInput = result;
        }

        waitForSecondOperand = true;
        operator = nextOperator;
        display.value = currentInput;
    }

    const performCalculation = {
        '/': (first, second) => first / second,
        '*': (first, second) => first * second,
        '+': (first, second) => first + second,
        '-': (first, second) => first - second,
        '=': (first, second) => second
    };

    function calculateSpecial(type) {
        let val = parseFloat(currentInput);
        if (isNaN(val)) return;

        let result = val;
        switch (type) {
            case 'sqrt':
                result = Math.sqrt(val);
                break;
            case 'pow2':
                result = val * val;
                break;
            case '1/x':
                result = 1 / val;
                break;
            case 'negate':
                result = val * -1;
                break;
            case 'sin':
                result = Math.sin(val * (Math.PI / 180)); // Assume degree input
                break;
            case 'cos':
                result = Math.cos(val * (Math.PI / 180)); // Assume degree input
                break;
            case 'tan':
                result = Math.tan(val * (Math.PI / 180)); // Assume degree input
                break;
            case 'log':
                result = Math.log10(val);
                break;
            case 'ln':
                result = Math.log(val);
                break;
            case 'pi':
                result = Math.PI;
                break;
            case 'e':
                result = Math.E;
                break;
            case 'perc':
                result = val / 100;
                break;
        }
        currentInput = String(result.toFixed(8));
        display.value = currentInput;
        waitForSecondOperand = true;
    }
    
    // --- Age Calculator Logic (FIXED & ENHANCED) ---
    function calculateAge() {
      const fromStr = document.getElementById('age-from').value;
      const toStr = document.getElementById('age-to').value;

      if (!fromStr || !toStr) {
        document.getElementById('age-result').textContent = "--";
        return;
      }

      const fromDate = new Date(fromStr);
      const toDate = new Date(toStr);
      const resultDiv = document.getElementById('age-result');

      // Validation
      if (fromDate > toDate) {
        resultDiv.innerHTML = "<span class='text-red-500 text-lg'>Start date must be earlier</span>";
        return;
      }

      let years = toDate.getFullYear() - fromDate.getFullYear();
      let months = toDate.getMonth() - fromDate.getMonth();
      let days = toDate.getDate() - fromDate.getDate();

      // Adjust for negative days (borrow from previous month)
      if (days < 0) {
        months--;
        // Get number of days in the previous month
        let prevMonthLastDay = new Date(toDate.getFullYear(), toDate.getMonth(), 0).getDate();
        days += prevMonthLastDay;
      }

      // Adjust for negative months (borrow from previous year)
      if (months < 0) {
        years--;
        months += 12;
      }

      resultDiv.innerHTML = 
        `${years}<span class="text-xl font-normal text-slate-400">y</span> ` + 
        `${months}<span class="text-xl font-normal text-slate-400">m</span> ` + 
        `${days}<span class="text-xl font-normal text-slate-400">d</span>`;
    }

    // --- BMI Calculator Logic (FIXED & ENHANCED) ---
    function calcBMI() {
      const hInput = parseFloat(document.getElementById('bmi-height').value);
      const w = parseFloat(document.getElementById('bmi-weight').value);
      const resEl = document.getElementById('bmi-res');
      const catEl = document.getElementById('bmi-category');

      if (!hInput || !w) {
        resEl.textContent = "--";
        catEl.textContent = "Enter details";
        resetTableHighlight();
        return;
      }

      // Smart Unit Detection: If height is large (e.g., > 3), assume cm and convert to meters. Otherwise, assume meters.
      const h_meters = (hInput > 3.0) ? hInput / 100 : hInput;

      // Calculation: BMI = weight (kg) / [height (m)]^2
      const bmi = (w / (h_meters * h_meters)).toFixed(1);

      // Display Result
      resEl.textContent = bmi;

      // Determine Category
      let cat = "", color = "", rowId = "";
      resetTableHighlight();

      if (bmi < 18.5) {
        cat = "Underweight"; color = "text-blue-500"; rowId = "row-under";
      } else if (bmi < 25) { // 18.5 - 24.9
        cat = "Normal Weight"; color = "text-green-600"; rowId = "row-normal";
      } else if (bmi < 30) { // 25 - 29.9
        cat = "Overweight"; color = "text-orange-500"; rowId = "row-over";
      } else { // >= 30
        cat = "Obesity"; color = "text-red-500"; rowId = "row-obese";
      }

      catEl.className = "text-xl font-bold " + color;
      catEl.textContent = cat;
      
      // Highlight the corresponding table row for user reference
      const row = document.getElementById(rowId);
      if(row) row.classList.add('bg-indigo-100', 'dark:bg-slate-700');
    }

    function resetTableHighlight() {
      // Helper function to clear BMI table highlights
      ['row-under', 'row-normal', 'row-over', 'row-obese'].forEach(id => {
        const el = document.getElementById(id);
        if(el) el.classList.remove('bg-indigo-100', 'dark:bg-slate-700');
      });
    }

    // --- Unit Converter Functions (retained, but ensures all code is in one block) ---
    function updateUnits() {
        const cat = document.getElementById('unit-category').value;
        currentCategory = cat;

        const unitsHtml = Object.keys(units[cat]).map(u=>`<option value="${u}">${u.toUpperCase()}</option>`).join('');

        document.getElementById('unit-from').innerHTML = unitsHtml;
        document.getElementById('unit-to').innerHTML = unitsHtml;

        // Set default values (e.g., m to km for length)
        if (cat === 'length') {
            document.getElementById('unit-from').value = 'm';
            document.getElementById('unit-to').value = 'km';
        } else if (cat === 'mass') {
            document.getElementById('unit-from').value = 'kg';
            document.getElementById('unit-to').value = 'lb';
        } else if (cat === 'volume') {
            document.getElementById('unit-from').value = 'l';
            document.getElementById('unit-to').value = 'ml';
        } else if (cat === 'temperature') {
            document.getElementById('unit-from').value = 'c';
            document.getElementById('unit-to').value = 'f';
        }
        
        // Run conversion if values exist
        convertUnit();
    }

    function convertUnit() {
        const cat = currentCategory;
        const from = document.getElementById('unit-from').value;
        const to = document.getElementById('unit-to').value;
        const val = parseFloat(document.getElementById('unit-input').value);

        if (isNaN(val) || val === '') {
            document.getElementById('unit-res').textContent = '--';
            return;
        }

        let result = val;

        if (cat === 'temperature') {
            // Special case for temperature conversion
            let baseC;
            switch(from) {
                case 'c': baseC = val; break;
                case 'f': baseC = (val - 32) * (5/9); break;
                case 'k': baseC = val - 273.15; break;
            }

            switch(to) {
                case 'c': result = baseC; break;
                case 'f': result = (baseC * (9/5)) + 32; break;
                case 'k': result = baseC + 273.15; break;
            }

            result = parseFloat(result.toFixed(2));
        } else {
            // General formula: Convert 'from' to base unit (factor is 1), then multiply by 'to' factor.
            // result = (val / units[cat][from]) * units[cat][to];
            
            // Correct logic:
            result = (val / units[cat][from]) * units[cat][to];
            
            // Clean up floating point errors
            if (result < 0.0001 && result !== 0) result = result.toExponential(4);
            else result = parseFloat(result.toFixed(4));
        }

        document.getElementById('unit-res').textContent = result + ' ' + to.toUpperCase();
    }
</script>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const currentPage = location.pathname.split('/').pop() || 'index.html';

    document.querySelectorAll('.nav-link').forEach(link => {
      if (link.getAttribute('href') === currentPage) {
        link.classList.add('text-indigo-600', 'font-bold');
        link.classList.remove('text-slate-700', 'dark:text-slate-300', 'hover:text-indigo-600');
      } else {
        link.classList.add('text-slate-700', 'dark:text-slate-300', 'hover:text-indigo-600');
      }
    });
  });
</script>
</body>
</html>
